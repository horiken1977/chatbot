# ファイル構成ガイド：Claude.md vs 設定ファイル

## 概要

このプロジェクトでは、**ハイブリッド方式**を採用しています。

---

## 3つのファイルの役割分担

### 1. `CLAUDE.md` - 人間が読みやすいガイド

**目的**: Claude AI が優先的に参照する、包括的なプロジェクトガイド

**特徴**:
- ✅ 可視性が高い（ファイル一覧で見える）
- ✅ 編集しやすい（通常のMarkdownファイル）
- ✅ 読みやすい（人間とAI両方にとって）
- ⚠️ 読み込み確実性は中程度

**内容**:
- プロジェクトミッション
- 絶対に守るべきルール（わかりやすく説明）
- 開発の進め方（具体例付き）
- よくある質問への回答
- チェックリスト

**いつ更新する**:
- 新しいベストプラクティスが見つかったとき
- よくある質問が追加されたとき
- プロジェクトフェーズが変わったとき

---

### 2. `.clauderc` - 技術的な設定（自動読み込み）

**目的**: Claude Code が確実に読み込むプロジェクト設定ファイル

**特徴**:
- ✅ 読み込み確実性が高い（Claude Codeの標準機能）
- ✅ セッション開始時に自動読み込み
- △ 隠しファイル（可視性低い）

**内容**:
- プロジェクト基本情報
- セッション開始チェックリスト
- 絶対禁止事項（簡潔に）
- 必須プロセスのステップ
- 主要ドキュメントへのリンク
- クラッシュ復旧手順

**いつ更新する**:
- 開発フェーズが変わったとき
- 必須ルールが追加されたとき
- 「次のステップ」が変わったとき

---

### 3. `.clinerules` - コーディングルール（自動適用）

**目的**: プロジェクト固有のコーディング規約を自動適用

**特徴**:
- ✅ Claude Code が自動適用
- ✅ コード生成時に参照される
- △ 隠しファイル

**内容**:
- コーディング規約
- ファイル命名規則
- インポート順序
- エラーハンドリング標準
- 禁止事項（技術的な詳細）

**いつ更新する**:
- 新しいコーディング規約が追加されたとき
- 禁止パターンが見つかったとき

---

## ファイル間の関係

```
CLAUDE.md (人間が読みやすい包括ガイド)
    │
    ├─ 詳細説明、具体例、Q&A
    │
    ▼
.clauderc (技術的な必須事項)
    │
    ├─ セッション開始時の自動読み込み
    ├─ 簡潔な必須ルール
    │
    ▼
.clinerules (コーディング規約)
    │
    └─ コード生成時の自動適用
```

---

## それぞれの優先度

### 読み込み優先度
1. **`.clauderc`** - 最優先（自動読み込み、確実）
2. **`CLAUDE.md`** - 高優先（わかりやすい）
3. **`.clinerules`** - コード生成時（自動適用）

### 編集頻度
1. **`CLAUDE.md`** - 頻繁（ガイド追加、Q&A更新）
2. **`.clauderc`** - 中程度（フェーズ変更時）
3. **`.clinerules`** - 低頻度（ルール追加時のみ）

---

## 具体例：ルールを追加する場合

### ケース1: 新しい禁止事項が見つかった

例：「`console.log` を本番コードに残さない」

**更新ファイル**:
1. ✅ `.clinerules` - 技術的な禁止事項として追加
2. ✅ `CLAUDE.md` - 理由と具体例を追加
3. △ `.clauderc` - 必要に応じて簡潔に言及

### ケース2: よくある質問が増えた

例：「環境変数を追加するときの手順は？」

**更新ファイル**:
1. ✅ `CLAUDE.md` - Q&Aセクションに詳しく追加
2. △ `.clauderc` - 必要に応じて簡潔に言及
3. ❌ `.clinerules` - 更新不要

### ケース3: 開発フェーズが変わった

例：「MVP完了、Phase 2開始」

**更新ファイル**:
1. ✅ `.clauderc` - 「次のステップ」を更新
2. ✅ `CLAUDE.md` - 開発状況セクションを更新
3. ❌ `.clinerules` - 更新不要

---

## 推奨：3ファイル連携の運用

### セッション開始時
```
1. .clauderc が自動読み込み（確実）
2. CLAUDE.md を参照して詳細確認（必要に応じて）
3. .clinerules がコード生成に自動適用
```

### コード変更時
```
1. .clauderc で必須プロセスを確認
2. CLAUDE.md で具体的な手順を確認
3. .clinerules に従ってコード生成
```

### トラブル時
```
1. CLAUDE.md の「トラブルシューティング」を確認
2. .clauderc の「クラッシュ復旧手順」を実行
```

---

## メンテナンスガイドライン

### 一貫性の保持
- 3ファイル間で矛盾がないように注意
- `.clauderc` と `CLAUDE.md` で同じルールを違う言い方で表現

**例**:
- `.clauderc`: 「❌ 環境変数ベタ書き」（簡潔）
- `CLAUDE.md`: 「環境変数は必ず `process.env` から取得し、ハードコードは絶対に避ける」（詳細 + 理由）

### 定期レビュー
- 月1回、3ファイルの内容を見直す
- 古い情報を削除
- 新しいベストプラクティスを追加

---

## まとめ：ハイブリッド方式の利点

### 利点
1. **確実性**: `.clauderc` で確実な自動読み込み
2. **わかりやすさ**: `CLAUDE.md` で詳細な説明
3. **自動適用**: `.clinerules` でコーディング規約を強制

### 運用のポイント
- **`.clauderc`**: シンプルに保つ（必須事項のみ）
- **`CLAUDE.md`**: 詳しく書く（具体例、Q&A）
- **`.clinerules`**: 技術的なルールのみ

### Claude.md だけでは不十分だった理由
- ✅ `CLAUDE.md` は読みやすいが、読み込みが不安定だった
- ✅ `.clauderc` を追加することで読み込みを確実に
- ✅ 両方を組み合わせることで、確実性とわかりやすさを両立

---

このハイブリッド方式により、Claude Code のクラッシュ後も確実にルールを適用し、
かつ人間にもわかりやすいドキュメントを維持できます。
