# 自動復旧セットアップガイド

## 概要
このドキュメントでは、Claude Codeのクラッシュ後に自動的に開発ルールを読み込み、作業を復旧する仕組みについて説明します。

---

## 自動読み込みの仕組み

### 1. プロジェクト設定ファイル

#### `.clauderc`
**場所**: プロジェクトルート
**目的**: セッション開始時に自動読み込みされる設定ファイル

**内容**:
- プロジェクト概要
- セッション開始時チェックリスト
- 絶対禁止事項
- コード変更プロセス
- クラッシュ復旧手順

#### `.clinerules`
**場所**: プロジェクトルート
**目的**: プロジェクト固有のコーディングルール

**内容**:
- コーディング規約
- ファイル命名規則
- エラーハンドリング標準
- 禁止事項

---

## MCP サーバー連携

### Cipher（対話記録）
**状態**: ✅ 自動有効

**機能**:
- すべての対話を自動記録
- クラッシュ後も記録は保持
- セッション開始時に前回の記録を自動参照

**記録内容**:
- 意思決定
- コード変更
- 問題と解決策
- セッション情報

### Serena（インテリジェントコーディング）
**状態**: ✅ 自動有効（`serena-chatbot`）

**機能**:
- プロジェクト構造の理解
- ベストプラクティスの提案
- コード生成の最適化

---

## クラッシュ復旧フロー

### 自動実行される処理

```
Claude Code 再起動
    ↓
1. .clauderc を自動読み込み
    ↓
2. .clinerules を自動読み込み
    ↓
3. Cipher の対話記録を参照（自動）
    ↓
4. Serena のプロジェクトコンテキスト読み込み（自動）
    ↓
準備完了
```

### ユーザーが確認すべきこと

#### ステップ1: セッションログ確認
```bash
# 最新のセッション記録を表示
tail -n 50 docs/session-log.md
```

確認内容:
- 前回の作業内容
- 次のステップ
- 未完了のタスク

#### ステップ2: 途中状態の確認
```bash
# 最近変更されたファイルを確認
find src -type f -mtime -1

# Gitの状態確認
git status
```

#### ステップ3: 作業再開
- セッションログの「次のステップ」から再開
- 必要に応じて影響範囲を再確認

---

## 設定ファイルの配置

### 現在の配置状況

```
chatbot/
├── .clauderc                    # ✅ セッション開始時の自動読み込み
├── .clinerules                  # ✅ コーディングルール
├── docs/
│   ├── development-guidelines.md    # 開発ガイドライン
│   ├── mcp-usage-guide.md          # MCP活用ガイド
│   ├── environment-variables.md     # 環境変数管理
│   ├── session-log.md              # セッションログ
│   └── impact-analysis/
│       └── TEMPLATE.md             # 影響範囲分析テンプレート
└── ~/.claude/
    └── config.json              # ✅ MCP設定（Cipher, Serena）
```

---

## 動作確認

### 1. Claude Code を再起動
```
1. VS Code を完全に終了
2. VS Code を再起動
3. 新しい Claude Code セッションを開始
```

### 2. 自動読み込みの確認
Claude Code が以下を自動的に認識していることを確認:
- [ ] プロジェクト概要
- [ ] 開発ガイドライン
- [ ] 絶対禁止事項
- [ ] Cipher の対話記録
- [ ] Serena のプロジェクトコンテキスト

### 3. テスト
簡単な質問をして、ガイドラインを認識しているか確認:

**質問例**:
```
「このプロジェクトでコード変更前に必ずやるべきことは？」
```

**期待される回答**:
- 影響範囲分析の実施
- ユーザー確認
- テスト計画の作成

---

## トラブルシューティング

### .clauderc が読み込まれていない

**確認方法**:
```bash
cat .clauderc
```

**解決策**:
1. ファイルがプロジェクトルートにあることを確認
2. Claude Code を完全に再起動
3. プロジェクトを再度開く

### Cipher が動作しない

**確認方法**:
```bash
cat ~/.claude/config.json | grep cipher
```

**解決策**:
```bash
# Cipher がインストールされているか確認
which cipher

# 設定ファイルを確認
cat ~/.claude/config.json
```

### Serena が動作しない

**確認方法**:
```bash
cat ~/.claude/config.json | grep serena-chatbot
```

**解決策**:
```bash
# uvx がインストールされているか確認
which uvx

# 手動でSerenaを起動してテスト
uvx --from git+https://github.com/oraios/serena serena --help
```

---

## メンテナンス

### 定期的な更新

#### .clauderc の更新タイミング
- プロジェクトフェーズが変わったとき
- 重要なルールが追加されたとき
- 現在のステップが変わったとき

#### session-log.md の更新
- 毎セッション終了時

#### development-guidelines.md の更新
- 新しいベストプラクティスが見つかったとき
- 問題が発生して対策を追加したとき

---

## ベストプラクティス

### 1. セッション開始時
```
1. .clauderc の内容を確認（自動）
2. session-log.md で前回の作業を確認
3. Cipher で詳細な対話記録を確認（自動）
4. 「次のステップ」から作業開始
```

### 2. セッション中
```
1. 重要な決定はすぐに Cipher に記録
2. コード変更前に影響範囲分析
3. Serena でベストプラクティス確認
```

### 3. セッション終了時
```
1. 実施内容を Cipher に記録
2. session-log.md を更新
3. 次のステップを明記
```

---

## まとめ

### 自動化されている機能
- ✅ .clauderc の読み込み
- ✅ .clinerules の読み込み
- ✅ Cipher の対話記録参照
- ✅ Serena のプロジェクトコンテキスト

### 手動で確認すべき機能
- 📋 session-log.md の確認
- 📋 前回の「次のステップ」確認
- 📋 途中状態のファイル確認

### クラッシュ復旧の所要時間
**通常**: 2-3分
1. Claude Code 再起動（自動）
2. session-log.md 確認（30秒）
3. 作業状況把握（1-2分）
4. 作業再開

---

この仕組みにより、クラッシュ後も迅速に作業を再開できます。
