# 開発計画書

## 1. 開発アプローチ

### 1.1 基本方針
- **アジャイル開発**: 2週間スプリント
- **MVP First**: 最小機能で早期リリース、フィードバックを得て改善
- **インクリメンタル**: 段階的に機能追加

### 1.2 品質基準
- TypeScriptで型安全性確保
- ESLint/Prettierでコード品質維持
- 主要機能のテストコード作成
- レスポンシブデザイン対応

---

## 2. Phase 1: MVP開発（4-6週間）

### Sprint 1-2: 環境構築・データパイプライン（2週間）

#### Week 1: プロジェクトセットアップ
- [ ] Next.js 14プロジェクト初期化
- [ ] TypeScript設定
- [ ] Tailwind CSS + shadcn/ui導入
- [ ] ESLint/Prettier設定
- [ ] Gitリポジトリセットアップ
- [ ] Vercelプロジェクト作成

**成果物**
- 基本的なNext.jsアプリが動作
- CI/CDパイプライン構築完了

#### Week 2: データパイプライン構築
- [ ] Supabaseプロジェクト作成
- [ ] データベーススキーマ作成（`knowledge_base`, `chat_history`）
- [ ] Google Sheets API設定
- [ ] データ取得スクリプト作成
  - [ ] スプレッドシート読み込み
  - [ ] データ構造化・クリーニング
  - [ ] チャンク分割ロジック
- [ ] Gemini Embedding API統合
- [ ] Supabaseへのデータ投入スクリプト
- [ ] 初期データ投入実行

**成果物**
- スプレッドシートデータがSupabaseに格納
- データ更新スクリプトが動作

---

### Sprint 2-3: コアRAG機能（2週間）

#### Week 3: RAG検索エンジン実装
- [ ] Supabase クライアント設定
- [ ] ベクトル検索関数実装
  - [ ] クエリのベクトル化
  - [ ] コサイン類似度検索
  - [ ] カテゴリフィルタ
  - [ ] Top-K件取得
- [ ] Gemini API統合
  - [ ] チャット補完API
  - [ ] プロンプトテンプレート作成
- [ ] `/api/chat` エンドポイント実装
- [ ] RAGフロー統合テスト

**成果物**
- APIで質問→回答が取得できる
- ハルシネーション抑制が機能

#### Week 4: チャットUI実装
- [ ] ポータルページ作成
  - [ ] BtoB/BtoC選択UI
- [ ] チャットページレイアウト
  - [ ] メッセージリストコンポーネント
  - [ ] 入力フォームコンポーネント
  - [ ] ローディング状態表示
- [ ] セッション管理（UUID生成）
- [ ] LocalStorageでの履歴保存
- [ ] ストリーミングレスポンス対応（オプション）

**成果物**
- ポータルからチャットまでのフロー完成
- 基本的な対話が可能

---

### Sprint 4: 関連トピック・履歴機能（1-2週間）

#### Week 5-6: 追加機能実装
- [ ] 関連トピック抽出ロジック
  - [ ] Geminiで関連キーワード抽出
  - [ ] 類似ベクトル検索
  - [ ] レコメンドUI表示
- [ ] チャット履歴機能
  - [ ] Supabaseへの履歴保存
  - [ ] `/api/history/:sessionId` 実装
  - [ ] 履歴一覧UI
  - [ ] 履歴からの会話再開
- [ ] エラーハンドリング
  - [ ] API エラー時の適切な表示
  - [ ] リトライ機能
- [ ] レスポンシブ対応調整
- [ ] パフォーマンス最適化

**成果物**
- 関連トピック提案が機能
- チャット履歴が保存・表示される

---

### Sprint 5: テスト・デプロイ（1週間）

#### Week 6-7: 品質保証・リリース
- [ ] 単体テスト作成
  - [ ] RAG検索ロジック
  - [ ] API エンドポイント
- [ ] E2Eテスト（Playwright）
  - [ ] ポータル→チャットフロー
  - [ ] 質問→回答フロー
- [ ] ブラウザ互換性テスト
  - [ ] iOS Safari
  - [ ] Android Chrome
- [ ] パフォーマンステスト
  - [ ] 応答時間測定
  - [ ] 同時接続テスト
- [ ] ステージング環境デプロイ
- [ ] ユーザー受け入れテスト（UAT）
- [ ] 本番環境デプロイ

**成果物**
- MVP本番リリース完了
- ユーザーに提供開始

---

## 3. Phase 2: 認証・管理機能（4週間）

### Sprint 6-7: ユーザー認証（2週間）
- [ ] Supabase Auth設定
- [ ] ログイン/サインアップUI
- [ ] ユーザー別履歴管理
- [ ] セッション管理強化
- [ ] アクセス制御

### Sprint 8-9: 管理機能（2週間）
- [ ] 管理画面UI
- [ ] データ更新機能（GUI）
- [ ] ユーザー管理
- [ ] 利用状況ダッシュボード

**成果物**
- 特定顧客のみアクセス可能
- 管理者がデータ更新可能

---

## 4. Phase 3: 分析・改善（継続的）

### 機能改善
- [ ] フィードバック機能（👍👎）
- [ ] 回答品質改善
  - [ ] プロンプトチューニング
  - [ ] チャンク分割最適化
- [ ] 検索精度向上
  - [ ] ハイブリッド検索（キーワード+ベクトル）
  - [ ] リランキング

### 分析機能
- [ ] 利用状況分析
  - [ ] よくある質問TOP10
  - [ ] 検索失敗パターン分析
- [ ] A/Bテスト基盤
- [ ] ユーザーフィードバック集計

---

## 5. マイルストーン

| マイルストーン | 期日 | 内容 |
|---------------|------|------|
| M1: 環境構築完了 | Week 1 | Next.js + Supabase環境ready |
| M2: データ投入完了 | Week 2 | スプレッドシート→DB投入 |
| M3: RAG動作確認 | Week 3 | APIで質問→回答取得 |
| M4: UI完成 | Week 4 | チャットUIで対話可能 |
| M5: MVP機能完了 | Week 6 | 関連トピック・履歴機能 |
| M6: MVP本番リリース | Week 7 | ユーザー提供開始 |
| M7: 認証機能追加 | Week 11 | ログイン機能実装 |
| M8: 管理機能追加 | Week 13 | 管理画面完成 |

---

## 6. リスク管理

### 技術リスク

| リスク | 影響度 | 対策 | 担当 |
|--------|--------|------|------|
| Gemini API制限超過 | 高 | キャッシュ実装、レート制限監視 | 開発者 |
| ベクトル検索精度不足 | 中 | チャンク分割調整、ハイブリッド検索検討 | 開発者 |
| スプレッドシート構造変更 | 中 | データスキーマバージョニング | 開発者 |
| パフォーマンス問題 | 低 | 早期ロードテスト実施 | 開発者 |

### スケジュールリスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| データパイプライン遅延 | 高 | Week 1から並行着手 |
| UAT フィードバック対応 | 中 | バッファ1週間確保 |
| Supabase無料枠超過 | 低 | 早期使用量監視 |

---

## 7. 成功基準

### MVP リリース時
- [ ] BtoC/BtoBの選択→チャットまでのフロー動作
- [ ] 質問に対して適切な回答を返す（精度80%以上）
- [ ] 応答時間5秒以内
- [ ] スマホブラウザで快適に動作
- [ ] チャット履歴が保存される
- [ ] 関連トピックが提案される

### Phase 2 完了時
- [ ] ユーザー認証機能動作
- [ ] 管理画面でデータ更新可能
- [ ] ユーザー別履歴管理

---

## 8. 開発環境

### ローカル環境
```bash
Node.js: v20.x
npm: v10.x
エディタ: VS Code
```

### 必要なアカウント
- [ ] Vercelアカウント
- [ ] Supabaseアカウント
- [ ] Google Cloud（Gemini API）
- [ ] Google Cloud（Sheets API）

### セットアップ手順
```bash
# 1. リポジトリクローン
git clone https://github.com/horiken1977/chatbot.git
cd chatbot

# 2. 依存関係インストール
npm install

# 3. 環境変数設定
cp .env.example .env.local
# .env.localに各種APIキーを設定

# 4. Supabaseマイグレーション
npm run db:migrate

# 5. 開発サーバー起動
npm run dev
```

---

## 9. チーム体制・役割

### 想定体制
- **開発者**: 1名（フルスタック）
- **レビュアー**: 1名（品質確認）
- **PO（プロダクトオーナー）**: 1名（要件確認・UAT）

### コミュニケーション
- **デイリー進捗**: Slack/チャット
- **週次レビュー**: 金曜日にデモ・振り返り
- **質問・相談**: 都度Slack

---

## 10. 次のアクション

### 即座に実施
1. **Supabaseアカウント作成**
   - https://supabase.com/ でサインアップ
   - 新規プロジェクト作成（東京リージョン推奨）

2. **Gemini API キー取得**
   - Google Cloud Consoleで有効化
   - APIキー生成

3. **Google Sheets API 有効化**
   - Google Cloud Consoleで有効化
   - サービスアカウント作成
   - スプレッドシートに閲覧権限付与

4. **Next.jsプロジェクト初期化**
   ```bash
   npx create-next-app@latest chatbot --typescript --tailwind --app
   cd chatbot
   npm install @supabase/supabase-js @google/generative-ai
   ```

5. **最初のコミット**
   ```bash
   git add .
   git commit -m "Initial project setup"
   git push origin main
   ```

---

## 11. 見積もり

### 工数見積もり（概算）
- **Phase 1 (MVP)**: 120-160時間（6-8週間、週20時間想定）
- **Phase 2 (認証・管理)**: 80時間（4週間）
- **Phase 3 (分析・改善)**: 継続的

### コスト見積もり
| 項目 | 月額コスト |
|------|-----------|
| Vercel Hobby | ¥0 |
| Supabase Free | ¥0 |
| Gemini API（法人契約） | 既存契約内 |
| **合計** | **¥0〜数百円** |

※無料枠内で運用可能。スケール時のみ有料プラン検討。

---

この計画に沿って開発を進めることで、6-8週間でMVPをリリースできる見込みです。
