# マーケティングナレッジチャットボット 要件定義書

## 1. プロジェクト概要

### 1.1 目的
マーケティング教育を受講したお客様向けに、学習内容を対話型で検索・参照できるAIチャットボットを提供する。

### 1.2 背景
- 現在、スマホアプリでマーケティング教育を提供中
- 教育コンテンツ（対話データ）はGoogleスプレッドシートで管理
- 受講者が学習内容を復習・検索できる仕組みが必要

### 1.3 データソース
- BtoC: https://docs.google.com/spreadsheets/d/1fxu0TE7zDafJtNBbNohpCrWoO3NQuIVTkS5qohPMiPk/edit?usp=sharing
  - M6CH01001シート以降、E7列以下に対話データが格納
- BtoB: 別途提供予定

---

## 2. 機能要件

### 2.1 MVP（最小viable product）フェーズ
#### 必須機能
1. **ポータル画面**
   - BtoBマーケティングとBtoCマーケティングを選択可能
   - それぞれ独立したチャットボットに遷移

2. **チャットボット機能**
   - 自然言語での質問入力
   - スプレッドシートデータに基づく回答生成（RAG方式）
   - ハルシネーション抑制（提供情報のみで回答）
   - 類似トピックのレコメンド表示
   - チャット履歴の保存・表示

3. **レスポンシブ対応**
   - スマホブラウザでの利用を主目的

#### 除外機能（将来フェーズ）
- ユーザー認証
- ユーザー別履歴管理
- 分析ダッシュボード

### 2.2 将来フェーズ
- ユーザー認証（特定顧客のみアクセス可能）
- ユーザー別チャット履歴管理
- 利用分析・レポート機能

---

## 3. 非機能要件

### 3.1 性能要件
- 想定同時接続ユーザー数: 10名
- 応答時間: 5秒以内（目標）

### 3.2 可用性
- 稼働率: 99%以上（Vercel標準）

### 3.3 セキュリティ
- HTTPS通信
- 環境変数でのAPIキー管理
- 将来的にユーザー認証機能追加

### 3.4 運用
- データ更新頻度: 半年に1回程度（手動バッチ処理で可）
- デプロイ: Vercel Hobby環境

---

## 4. 技術要件

### 4.1 デプロイ環境
- **プラットフォーム**: Vercel（Hobbyプラン）

### 4.2 LLM API
- **モデル**: Google Gemini（既存法人契約）
- **用途**:
  - 質問の意図理解
  - 検索結果からの回答生成
  - 類似トピック抽出

### 4.3 RAG構成
- **ベクトルDB検討**:
  - 候補1: Vercel Postgres + pgvector（Vercel統合、無料枠あり）
  - 候補2: Supabase（PostgreSQL + pgvector、無料枠あり）
  - 候補3: Chroma（オープンソース、セルフホスト可能）
- **埋め込みモデル**: Google Embedding API（Gemini連携）

### 4.4 データパイプライン
- Google Sheets API経由でデータ取得
- スクリプトによるベクトル化・DB格納
- 半年ごとの手動実行で可

---

## 5. 予算・コスト

### 5.1 予算上限
- 月額5万円以内

### 5.2 想定コスト
| 項目 | サービス | 想定月額 |
|------|----------|----------|
| ホスティング | Vercel Hobby | ¥0 |
| ベクトルDB | Supabase Free Tier | ¥0 |
| LLM API | Gemini API（法人契約） | 既存契約内 |
| 合計 | | ¥0〜数千円 |

※同時接続10名、月間数百〜数千クエリ程度であれば無料枠内で運用可能

---

## 6. データ構造

### 6.1 スプレッドシートデータ
- **シート構成**: M6CH01001以降が学習コンテンツ
- **データ列**: E7列以下に対話データ
- **内容**: キャラクター対話、質問、解説など

### 6.2 ベクトルDB格納データ
```
{
  "id": "ユニークID",
  "sheet_name": "シート名",
  "row_number": "行番号",
  "content": "対話テキスト",
  "context": "前後の文脈",
  "category": "BtoB | BtoC",
  "embedding": [ベクトル値]
}
```

### 6.3 チャット履歴
```
{
  "session_id": "セッションID",
  "timestamp": "タイムスタンプ",
  "user_message": "ユーザー質問",
  "bot_response": "ボット回答",
  "sources": ["参照元データID"],
  "recommendations": ["関連トピックID"]
}
```

---

## 7. ユーザーフロー

### 7.1 基本フロー
1. ユーザーがポータルページにアクセス
2. BtoB/BtoCを選択
3. チャット画面に遷移
4. 質問を入力
5. システムが関連データを検索（RAG）
6. Gemini APIで回答生成
7. 回答 + 関連トピック表示
8. 履歴保存

### 7.2 関連トピック選択フロー
1. 「関連する情報で○○もありますが、調べますか？」表示
2. ユーザーがクリック
3. 該当トピックの詳細を表示

---

## 8. 開発フェーズ計画

### Phase 1: MVP開発（優先度: 高）
- [ ] 技術スタック選定・環境構築
- [ ] スプレッドシートデータ取得スクリプト
- [ ] ベクトルDB構築・データ投入
- [ ] ポータル画面（BtoB/BtoC選択）
- [ ] チャットUI実装
- [ ] RAG検索機能実装
- [ ] Gemini API統合
- [ ] チャット履歴機能
- [ ] 関連トピックレコメンド機能
- [ ] Vercelデプロイ

### Phase 2: 認証・管理機能（優先度: 中）
- [ ] ユーザー認証機能
- [ ] ユーザー別履歴管理
- [ ] 管理画面（データ更新UI）

### Phase 3: 分析・改善（優先度: 低）
- [ ] 利用状況分析
- [ ] 検索精度改善
- [ ] UI/UX改善

---

## 9. 成功指標

### 9.1 技術指標
- 応答速度: 平均5秒以内
- 検索精度: ユーザー質問の80%以上で適切な情報を返す
- システム稼働率: 99%以上

### 9.2 ビジネス指標
- ユーザー満足度（将来的にフィードバック機能で測定）
- 月間アクティブユーザー数
- 1ユーザーあたり平均質問数

---

## 10. リスク管理

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Gemini API利用制限超過 | 高 | レート制限監視、キャッシュ機能実装 |
| スプレッドシート構造変更 | 中 | データ取得スクリプトのバージョン管理 |
| ベクトルDB無料枠超過 | 中 | 使用量監視、必要に応じ有料プラン検討 |
| ハルシネーション発生 | 高 | プロンプト最適化、検索精度向上 |

---

## 11. 次のステップ

1. **技術スタックの最終決定**
   - フロントエンド: Next.js + TypeScript
   - バックエンド: Next.js API Routes
   - ベクトルDB: Supabase（推奨）

2. **プロトタイプ開発開始**
   - 環境構築
   - データ取得・ベクトル化スクリプト作成
   - 基本的なチャットUI実装

3. **ステークホルダーレビュー**
   - 要件の最終確認
   - 開発スケジュール合意
